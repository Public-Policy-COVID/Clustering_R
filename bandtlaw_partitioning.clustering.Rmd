---
title: "Clustering Analyses: Partitioning"
author: "Bryn Bandt-law"
date: "2/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo= TRUE)
```

**Clustering Technique: Partitioning**

(1) read in Group 4 merged data set from out github folder

```{r}
library(readr)

link='https://raw.githubusercontent.com/Public-Policy-COVID/students_merge/main/Merged_data.csv'

data = read.csv(link)

# reset indexes to R format:
row.names(data)=NULL

#View(data)
```

Partitioning: "You will request a particular number of clusters to the algorithm. The algorithm will put every case in one of those clusters. Outliers will affect output".

```{r}
#for clustering, the variables need to be numeric
data$Deaths_COVID<-as.numeric(data$Deaths_COVID)

data$Deaths_total<-as.numeric(data$Deaths_total)
```

a. explore variables to use for clustering
```{r}
#names(data)

dfClus=data[,c('Number_of_beds','mask_score','Deaths_COVID','Deaths_total','Number_of_hospitals', "black_total_pct","white_total_pct")]

summary(dfClus)
```

b. rescale unites
```{r}
dfClus=scale(dfClus)
summary(dfClus)
```
c. rename subset indexes and  verify input:
```{r}
#Rename subset indexes and verify input:
row.names(dfClus)=data$Location
head(dfClus)

```


d. set random seed
```{r}
set.seed(999) #note: this  if for the replicability of results

```

e. designate distance method and compute distance  matrix
```{r}

library(cluster)
dfClus_D=cluster::daisy(x=dfClus)

```

f. For the partitioning technique, we need to indicate the number of clusters required
```{r}
NumCluster=4
res.pam = pam(x=dfClus_D,
              k = NumCluster,
              cluster.only = F)
```

g.Append the  clustering results to the dataframe (data)
```{r}
data$pam=as.factor(res.pam$clustering)

```


h. query the data frame

```{r}
table(data$pam) #create table to see n counties per cluster 

data[data$Location=="King_WA",'pam'] #examine King County, WA

```


**Evaluate results**

(a)create average sillohuetes
```{r}
#create average silhouettes:
library(factoextra)
fviz_silhouette(res.pam)

#average silhouette width: .23
```

(b) detect anomolies:
      -save individual silhouettes
     
```{r}
# save individual silhouettes
pamEval=data.frame(res.pam$silinfo$widths)
head(pamEval)

```
      -request negative silhouettes.
      A negative silhouettes indicates that the item
      is poorly clustered 

```{r}
pamEval[pamEval$sil_width<0,]
```



